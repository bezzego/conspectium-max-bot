# conspectium-max-bot

Чат-бот | Mini App для платформы MAX

## Backend (FastAPI + PostgreSQL)

### Быстрый старт

```bash
# Установить зависимости
poetry install

# Скопировать переменные окружения
cp .env.example .env

# Отредактировать .env (БД, Telegram Bot Token, GOOGLE_API_KEY и т.д.)

# Применить миграции
poetry run alembic upgrade head

# Запустить сервер
poetry run uvicorn app.main:app --reload
```

### Основные возможности
- Авторизация пользователей через Telegram Mini App (валидация `initData`, выдача JWT).
- Загрузка и хранение аудио, подготовка транскрипта.
- Генерация конспекта и теста с помощью Google Gemini (`gemini-2.5-flash`).
- Поддержка двух вариантов конспекта (сжатый и полный) с выбором прямо в интерфейсе.
- Асинхронные задачи генерации (фоновая обработка, трекинг состояния).
- REST API для управления конспектами, тестами и статусом задач.

### Модульная структура
- `app/core` — конфигурация, настройки.
- `app/db` — сессия БД, инициализация.
- `app/models` — SQLAlchemy модели и перечисления.
- `app/schemas` — Pydantic-схемы запросов/ответов.
- `app/api` — роуты FastAPI.
- `app/services` — сервисы (Telegram auth, генерация с Gemini, работа с файлами).
- `alembic/` — миграции базы данных.

### Полезные команды
- `poetry run pytest` — тесты.
- `poetry run ruff check .` — статический анализ.
- `poetry run black .` — форматирование.

### Работа с фронтом
- После запуска сервера перейдите на `http://127.0.0.1:8000/front/html/main.html`.
- В режиме разработки фронт авторизуется автоматически через эндпоинт `/api/auth/dev-login`.
- Все списки (конспекты, тесты) подгружаются из БД; создание конспектов и тестов выполняется через реальный API.
- Страницы:
  - `main.html` — главная, просмотр последних конспектов, загрузка аудио.
  - `conspect_create.html` — генерация конспекта из аудио или текста.
  - `choose_test.html` — выбор конспекта и запуск генерации теста.
  - `test.html?quizId=<id>` — прохождение реального теста из базы.
