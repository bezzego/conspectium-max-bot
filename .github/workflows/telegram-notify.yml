on:
  push:
  pull_request:
  issues:
    types: [opened, closed, reopened, edited]
  pull_request_review:
    types: [submitted]
  release:
    types: [published, created, edited]
  create:
  delete:
  fork:
  watch:
    types: [started]
  workflow_run:
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
      TG_CHAT_IDS: ${{ secrets.TG_CHAT_IDS }}
    steps:
      - name: Send Telegram message
        run: |
          EVENT="${{ github.event_name }}"
          ACTOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          BRANCH="${{ github.ref_name }}"
          URL="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"

          # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ–±—ã—Ç–∏—è
          case "$EVENT" in
            push)
              COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | head -n 1)
              MESSAGE="üü¢ *Push –≤ [$REPO]($URL)*%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)%0A–ë—Ä–∞–Ω—á: \`$BRANCH\`%0A–ö–æ–º–º–∏—Ç: _$COMMIT_MSG_"
              ;;
            pull_request)
              TITLE="${{ github.event.pull_request.title }}"
              ACTION="${{ github.event.action }}"
              PR_URL="${{ github.event.pull_request.html_url }}"
              MESSAGE="üì¶ *Pull Request $ACTION*%0A[$TITLE]($PR_URL)%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            pull_request_review)
              ACTION="${{ github.event.action }}"
              PR_URL="${{ github.event.pull_request.html_url }}"
              MESSAGE="üó£ *Review $ACTION*%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)%0A[–°–º–æ—Ç—Ä–µ—Ç—å PR]($PR_URL)"
              ;;
            issues)
              TITLE="${{ github.event.issue.title }}"
              ACTION="${{ github.event.action }}"
              ISSUE_URL="${{ github.event.issue.html_url }}"
              MESSAGE="üóÇ *Issue $ACTION*%0A[$TITLE]($ISSUE_URL)%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            release)
              REL_URL="${{ github.event.release.html_url }}"
              REL_NAME="${{ github.event.release.name }}"
              MESSAGE="üöÄ *–ù–æ–≤—ã–π —Ä–µ–ª–∏–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!*%0A[$REL_NAME]($REL_URL)%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            create)
              REF="${{ github.ref }}"
              MESSAGE="‚ú® *–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ç–∫–∞ –∏–ª–∏ —Ç–µ–≥:* \`$REF\`%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            delete)
              REF="${{ github.ref }}"
              MESSAGE="üóë *–£–¥–∞–ª–µ–Ω–∞ –≤–µ—Ç–∫–∞ –∏–ª–∏ —Ç–µ–≥:* \`$REF\`%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            fork)
              MESSAGE="üç¥ *–ù–æ–≤—ã–π —Ñ–æ—Ä–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [$REPO](https://github.com/$REPO)*%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            watch)
              MESSAGE="‚≠êÔ∏è *–ù–æ–≤—ã–π –∑–≤—ë–∑–¥–æ—á–Ω—ã–π –ª–∞–π–∫!*%0A–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: [$REPO](https://github.com/$REPO)%0A–û—Ç: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            workflow_run)
              STATUS="${{ github.event.workflow_run.conclusion }}"
              WF_NAME="${{ github.event.workflow_run.name }}"
              WF_URL="${{ github.event.workflow_run.html_url }}"
              MESSAGE="‚öôÔ∏è *Workflow –∑–∞–≤–µ—Ä—à—ë–Ω:* [$WF_NAME]($WF_URL)%0A–°—Ç–∞—Ç—É—Å: *$STATUS*%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)"
              ;;
            *)
              MESSAGE="üìò *–°–æ–±—ã—Ç–∏–µ:* $EVENT%0A–ê–≤—Ç–æ—Ä: [$ACTOR](https://github.com/$ACTOR)%0A[$REPO]($URL)"
              ;;
          esac

          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–µ —á–∞—Ç—ã
          for CHAT_ID in $TG_CHAT_IDS; do
            echo "–û—Ç–ø—Ä–∞–≤–ª—è—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ $CHAT_ID"
            curl -s -X POST "https://api.telegram.org/bot$TG_BOT_TOKEN/sendMessage" \
                 -d chat_id="$CHAT_ID" \
                 -d parse_mode="Markdown" \
                 -d text="$MESSAGE"
          done